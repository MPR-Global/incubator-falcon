<form id="formTimingBox"
      name="timingForm"
      class="col-xs-24"
      ng-class="{displayValidations:validation.show}"
      novalidate>

  <div class="row">
    <h4 class="col-xs-24">Timing</h4>
    <div class="col-xs-24 timingBox">
      <div class="startOnBox">
        <label>Start on
          <input type="text"
                 name="startDateInput"
                 class="form-control dateInput"
                 placeholder="mm/dd/yyyy"
                 datepicker-popup="{{dateFormat}}"
                 ng-model="date.start"
                 is-open="opened"
                 ng-click="openDatePicker($event, date.start)"
                 ng-change="constructDate()"
                 ng-required="true"
                 simple-date>
        </label>
      </div>
      <div class="timeBox">
        <label>Time
          <timepicker ng-change="constructDate()"
                      ng-model="date.time"
                      hour-step="1"
                      minute-step="1"
                      show-meridian="true">
          </timepicker>
        </label>
      </div>
      <div class="tzBox">
        <time-zone-select
                ng-model="date.tz"
                class=""
                ng-change="constructDate()">
        </time-zone-select>
      </div>
      <div class="validationError"
           ng-if="timingForm.startDateInput.$error.date">
        {{validation.messages.date.patternInvalid}}
      </div>
      <div class="validationError"
           ng-if="timingForm.startDateInput.$error.required && validation.show">
        {{validation.messages.date.empty}}
      </div>
    </div>
    <br />


    <div class="col-xs-24 mt10">
      <div class="frequencyBox">
        <div>
          <label>Frequency</label>
        </div>
        <div>
          <label>
            Every
            <input type="text"
                   name="frequencyEveryInput"
                   ng-model="model.frequency.every"
                   ng-pattern="validation.patterns.twoDigits"
                   ng-required="true"
                   ng-keydown="validation.acceptOnlyNumber($event)"
                   class="form-control"/>
            <select ng-model="model.frequency.unit"
                    ng-required="true"
                    class="form-control">
              <option selected value="hours">hours</option>
              <option value="minutes">minutes</option>
            </select>
          </label>
          <div class="validationError"
               ng-if="timingForm.frequencyEveryInput.$error.pattern">
            {{validation.messages.number.patternInvalid}}
          </div>
          <div class="validationError"
               ng-if="timingForm.frequencyEveryInput.$error.required && validation.show">
            {{validation.messages.number.empty}}
          </div>
        </div>
      </div>
      <div class="repeatsBox">
        <div><label>Repeats</label></div>
        <div>
          <label>
            Every
            <input type="text"
                   name="repeatsEveryInput"
                   ng-model="model.repeats.every"
                   ng-pattern="validation.patterns.twoDigits"
                   ng-required="true"
                   ng-keydown="validation.acceptOnlyNumber($event)"
                   class="form-control"/>
            <select ng-model="model.repeats.unit"
                    ng-required="true"
                    class="form-control">
              <option selected value="days">Days</option>
              <option value="weeks">Weeks</option>
              <option value="months">Months</option>
              <option value="years">Years</option>
            </select>
          </label>
          <div class="validationError"
               ng-if="timingForm.repeatsEveryInput.$error.pattern">
            {{validation.messages.number.patternInvalid}}
          </div>
          <div class="validationError"
               ng-if="timingForm.repeatsEveryInput.$error.required && validation.show">
            {{validation.messages.number.empty}}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <h4 class="col-xs-24 mt20">Allocation</h4>
    <div class="col-xs-24">

      <div class="maxNumberSlotsBox">
        <label>Max number of slots
          <input type="text"
                 name="maxSlotsInput"
                 ng-model="model.allocation.max_number_slots"
                 ng-pattern="validation.patterns.number"
                 ng-required="true"
                 ng-keydown="validation.acceptOnlyNumber($event)"
                 class="form-control"/>
        </label>
        <div class="validationError"
             ng-if="timingForm.maxSlotsInput.$error.pattern">
          {{validation.messages.allocationNumber.patternInvalid}}
        </div>
        <div class="validationError"
             ng-if="timingForm.maxSlotsInput.$error.required && validation.show">
          {{validation.messages.allocationNumber.empty}}
        </div>
      </div>

      <div class="maxBandwidthBox">
        <label>Max bandwidth
          <input type="text"
                 name="maxBandwidthInput"
                 ng-model="model.allocation.max_bandwidth"
                 ng-pattern="validation.patterns.number"
                 ng-required="true"
                 ng-keydown="validation.acceptOnlyNumber($event)"
                 class="form-control"/>
        </label>
        <div class="validationError"
             ng-if="timingForm.maxBandwidthInput.$error.pattern">
          {{validation.messages.allocationNumber.patternInvalid}}
        </div>
        <div class="validationError"
             ng-if="timingForm.maxBandwidthInput.$error.required && validation.show">
          {{validation.messages.allocationNumber.empty}}
        </div>
      </div>

      <div class="unitRadioBox">
        <label>
          <input type="radio"
                 value="Kb"
                 ng-model="model.allocation.measure" />
          Kb
        </label>
        <label>
          <input type="radio"
                 value="Mb"
                 ng-model="model.allocation.measure" />
          Mb
        </label>
        <label>
          <input type="radio"
                 value="Gb"
                 ng-model="model.allocation.measure" />
          Gb
        </label>
      </div>
    </div>
  </div>

  <div class="row">
    <h4 class="col-xs-24 mt20">Others</h4>
    <div class="col-xs-24 othersBox">
      <div class="runJobAsBox">
        <label>Run job as
          <select ng-model="model.run_as"
                  ng-required="true"
                  class="form-control">
            <option value="default" selected>defaultUser</option>
            <option ng-repeat="user in usersList" value="{{user.name}}">{{user.name}}</option>
          </select>
        </label>
      </div>
      <div class="dataPermissions">
        <label>Data permissions
          <input type="text"
                 name="dataPermissionInput"
                 ng-model="model.permission"
                 ng-pattern="validation.patterns.unixPermissions"
                 ng-required="true"
                 ng-keydown="validation.acceptOnlyNumber($event)"
                 class="form-control"/>
        </label>
        <div class="validationError"
             ng-if="timingForm.dataPermissionInput.$error.pattern">
          {{validation.messages.permission.patternInvalid}}
        </div>
        <div class="validationError"
             ng-if="timingForm.dataPermissionInput.$error.required && validation.show">
          {{validation.messages.permission.empty}}
        </div>
      </div>
      <div class="onErrorBox">
        <div class="onErrorHeaderBox">
          <label>On error:
            <label>
              <input type="radio"
                     ng-model="model.on_error.action"
                     value="abort"
                     ng-change="onErrorTransform()"/>
              Abort
            </label>
            <label>
              <input type="radio"
                     ng-model="model.on_error.action"
                     value="retry"
                     ng-change="onErrorTransform()"/>
              Retry
            </label>
          </label>
        </div>

        <div class="policyBox" ng-if="model.on_error.action === 'abort'">
          <div><label>Policy</label></div>
          <label>
            <input type="radio" value="back-off" ng-change="onErrorTransform()" ng-model="abortOptions.policy"/>
            Back off
          </label>
          <label>
            <input type="radio" value="exp-back-off" ng-change="onErrorTransform()" ng-model="abortOptions.policy"/>
            Exp back off
          </label>
        </div>
        <div class="retryBox" ng-if="model.on_error.action === 'retry'">
          <div class="retryEveryBox">
            <label>Retry every</label>
            <input type="text"
                   name="retryEveryInput"
                   ng-model="retryOptions.retry_every.number"
                   ng-pattern="validation.patterns.twoDigits"
                   ng-required="model.on_error.action === 'retry'"
                   ng-change="onErrorTransform()"
                   ng-keydown="validation.acceptOnlyNumber($event)"
                   class="form-control"/>
            <select ng-model="retryOptions.retry_every.unit"
                    ng-change="onErrorTransform()"
                    ng-required="true"
                    class="form-control">
              <option value="seconds">Seconds</option>
              <option value="minutes">Minutes</option>
              <option value="hours">Hours</option>
              <option value="days">Days</option>
              <option value="weeks">Weeks</option>
              <option value="months">Months</option>
            </select>
            <div class="validationError"
                 ng-if="timingForm.retryEveryInput.$error.pattern">
              {{validation.messages.number.patternInvalid}}
            </div>
            <div class="validationError"
                 ng-if="timingForm.retryEveryInput.$error.required && validation.show">
              {{validation.messages.number.empty}}
            </div>
          </div>
          <div class="stopOnBox">
            <label>Stop on</label>
            <div>
              <label>
                <input type="radio" value="attempts" ng-model="retryOptions.stop_on.value" ng-change="onErrorTransform()"/>
                <input type="text"
                       name="attemptsNumberInput"
                       ng-model="retryOptions.stop_on.attempts.number"
                       ng-pattern="validation.patterns.number"
                       ng-required="model.on_error.action === 'retry' && retryOptions.stop_on.value === 'attempts'"
                       ng-change="onErrorTransform()"
                       ng-keydown="validation.acceptOnlyNumber($event)"
                       class="form-control"/>
                attempts
              </label>
              <div class="validationError"
                   ng-if="timingForm.attemptsNumberInput.$error.pattern">
                {{validation.messages.number.patternInvalid}}
              </div>
              <div class="validationError"
                   ng-if="timingForm.attemptsNumberInput.$error.required && validation.show">
                {{validation.messages.number.empty}}
              </div>
            </div>
            <div>
              <label>

                <input type="radio"
                       value="without_response"
                       ng-model="retryOptions.stop_on.value"
                       ng-change="onErrorTransform()"/>

                <input type="text"
                       name="withoutResponseNumberInput"
                       ng-model="retryOptions.stop_on.without_response.number"
                       ng-pattern="validation.patterns.twoDigits"
                       ng-required="model.on_error.action === 'retry' && retryOptions.stop_on.value === 'without_response'"
                       ng-change="onErrorTransform()"
                       ng-keydown="validation.acceptOnlyNumber($event)"
                       class="form-control"/>

                <select ng-model="retryOptions.stop_on.without_response.unit"
                        ng-required="true"
                        ng-change="onErrorTransform()"
                        class="form-control">
                  <option value="seconds">Seconds</option>
                  <option value="minutes">Minutes</option>
                  <option value="hours">Hours</option>
                  <option value="days">Days</option>
                  <option value="weeks">Weeks</option>
                  <option value="months">Months</option>
                  <option value="years">Years</option>
                </select>

                without response
              </label>
              <div class="validationError"
                   ng-if="timingForm.withoutResponseNumberInput.$error.pattern">
                {{validation.messages.number.patternInvalid}}
              </div>
              <div class="validationError"
                   ng-if="timingForm.withoutResponseNumberInput.$error.required && validation.show">
                {{validation.messages.number.empty}}
              </div>
            </div>
            <div>
              <label>
                <input type="radio" value="never" ng-model="retryOptions.stop_on.value" ng-change="onErrorTransform()"/>
                Never
              </label>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-24 alertsBox">
      <div class="to">
        <label> <h4>Send alerts to </h4>
          <input class="form-control"
                 name="emailAlertInput"
                 ng-model="emailAlert.email"
                 type="text"
                 placeholder="Email"
                 ng-pattern="validation.patterns.email">
        </label>
      </div>
      <div class="on">
        <h4>on </h4>
        <label>
          <input type="checkbox" ng-model="emailAlert.start"/>
          Start
        </label>
        <label>
          <input type="checkbox" ng-model="emailAlert.finish"/>
          Finish
        </label>
        <label>
          <input type="checkbox" ng-model="emailAlert.fail"/>
          Fail
        </label>
        <label>
          <input type="checkbox" ng-model="emailAlert.abort"/>
          Abort
        </label>
        <button class="btn btn-default btn-xs"
                ng-disabled="(!emailAlert.start&&!emailAlert.finish&&!emailAlert.fail&&!emailAlert.abort) || !emailAlert.email"
                type="button"
                ng-click="addAlert()">
          <span class="glyphicon glyphicon-plus"></span>add alert
        </button>
      </div>
      <div class="validationError"
           ng-if="timingForm.emailAlertInput.$error.pattern">
        {{validation.messages.email.patternInvalid}}
      </div>

      <div class="emailArrayRow" ng-repeat="email in model.alerts">
        <span>{{email.email}}</span> on
        <span ng-if="email.start">Start</span>
        <span ng-if="email.finish">Finish</span>
        <span ng-if="email.fail">Fail</span>
        <span ng-if="email.abort">Abort</span>
        <button class="btn btn-default btn-xs"
                type="button"
                ng-click="removeAlert()">
          <span class="glyphicon glyphicon-minus"></span> delete
        </button>
      </div>

    </div>
  </div>

  <div class="row">
    <div class="col-xs-24 mt20">
      <button type="button"
              id="timingBack" class="btn prevBtn"
              ng-click="goBack('form.general')"
              ng-disabled="buttonSpinners.backShow">
        Previous <img src="css/img/ajax-loader.gif" ng-if="buttonSpinners.backShow" />
      </button>
      <button id="timingNext"
              class="btn nextBtn pull-right"
              ng-click="goNext(timingForm.$invalid, 'form.summary')" >
        Next <img src="css/img/ajax-loader.gif" ng-if="buttonSpinners.show" />
      </button>
      <a class="pull-right" ng-click="cancel()">
        Cancel
      </a>
    </div>
  </div>

</form>


